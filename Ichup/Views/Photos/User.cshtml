@model PagedList.IPagedList<Ichup.Models.image>
@using PagedList.Mvc;
@{
    ViewBag.Title = "User";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var totalItemImage = 0;
}
<!-- ============================  Categories Start ============================ -->
    <style>
        tr {
            border-bottom:1px solid #0ff;
        }
    </style>
    <script>
        isLoadedCat=false;
        //getCategoryCk(@Model[0].id);
        acategory=@Html.Raw(@ViewBag.acategory);

        function setValueDefault(id,filter1,filter2,filter3,filter4,filter5){
            var index=0;
            var i=0;
            for(i=0;i<3;i++){
                index=i+1;
                if (filter1.indexOf(a1[i])>=0){
                    document.getElementById("f-"+id+"-1_"+index).checked=true;
                }
            }
            for(i=0;i<3;i++){
                index=i+1;
                if (filter2.indexOf(a2[i])>=0){
                    document.getElementById("f-"+id+"-2_"+index).checked=true;
                }
            }
            //console.log(acategory.length);
            //console.log(filter3);
            for(i=0;i<acategory.length;i++){
                index=i+1;
                //console.log(filter3);
                if (filter3.indexOf(acategory[i]+", ")>=0){
                    document.getElementById("f-"+id+"-3_"+index).checked=true;
                }
            }
        
        }
    </script>
    <section class="picture-categories">

      <div class="container">
        <div class="row">
          <div class="span12">
            <div class="single-image-container">
              <div class="row-fluid">
                <div class="span1">

                  <h4 class="title">Quản lý ảnh</h4>                  
                </div> <!-- end span1 -->

                <div class="span11">
                    <ul class="nav nav-tabs">
                      <li class="active"><a href="#"><i class="icon-picture icon-large"></i></a></li>
                      <li><a href="#"><i class="icon-facetime-video icon-large"></i></a></li>
                      <li><a href="#"><i class="icon-music icon-large"></i></a></li>
                      <li><span style="color:red;">Đánh dấu vào các thuộc tính ảnh giúp user tìm được ảnh nhiều hơn!</span></li>
                    </ul>
                </div> <!-- end span8 -->
               
              </div><!--  end row-fluid -->
            </div> <!-- end single-image-container -->
          </div> <!-- end span12 -->

        </div> <!-- end row -->

        <div class="single-image-title v2">
          <div class="row">
            <div class="span12">
              
            </div> <!--end span12-->
          </div> <!-- end row -->
        </div> <!-- end single-image-title -->
      </div> <!-- end container -->

    </section> <!-- end picture-categories -->



    <!-- ============================  Categories End ============================ -->

    <!-- ============================  Image Decription Starts ============================ -->


    <section class="image-decription-container">
      <div class="container">
        <div class="row" style="text-align:center;">
            @foreach(var item in Model){
                
                <text>
                    <div class="span6" style="height:373px;" id="div-@item.id">
                        <figure>
                          <img src="@item.link_thumbail_big" alt="img" />
                        </figure>
                    </div> <!-- end span6 -->
                    <div class="span6" style="height:373px;" id="div-@item.id-2">
                        <table>
                             <tr><td align="left" width="70">Từ khóa</td><td align="left"><input type="text" id="keyword_@item.id" name="keyword_@item.id" value="@item.keywords" style="width:100%;"></td></tr>
                             @*<tr><td align="left" width="70">Giá bán</td><td align="left"><input type="text" id="price_@item.id" name="price_@item.id" value="@item.price" onblur="checkPrice(this);"></td></tr>*@
                             @*<tr><td align="left" width="70">Kiểu bán</td><td align="left">@Html.Raw(@Ichup.Config.getSaleType(@item.id,@item.sale_type))</td></tr>*@
                             <tr><td colspan="2"><b>Đánh dấu vào các thuộc tính mà ảnh này có</b></td></tr>
                             <tr>
                                 <td align="left"><b>Loại ảnh:</b></td>
                                 <td align="left">@Html.Raw(@Ichup.Config.getF1CkUser(@item.id,@item.filter_1))</td>
                             </tr>   
                            <tr>
                                 <td align="left"><b>Kiểu ảnh:</b></td>
                                 <td align="left">@Html.Raw(@Ichup.Config.getF2CkUser(@item.id,@item.filter_2))</td>
                             </tr>  
                            <tr>
                                 <td align="left"><b>Nhóm ảnh:</b></td>
                                 <td align="left" id="category_ck_list_@item.id">@Html.Raw(@Ichup.Config.getF3CkUser(@item.id,@item.filter_3))</td>
                             </tr>  
                            <tr>
                                 <td align="left"><b>Người:</b></td>
                                 <td align="left">@Html.Raw(@Ichup.Config.getF4CkUser(@item.id,@item.filter_4))
                                 </td>
                             </tr> 
                             <tr>
                                 <td align="left"><b>Góc chụp:</b></td>
                                 <td align="left">@Html.Raw(@Ichup.Config.getF5CkUser(@item.id,@item.filter_5))</td>
                             </tr>
                            <tr><td colspan="2"><input type="button" value="Save" onclick="save(@item.id);"><input type="button" value="Delete" onclick="del(@item.id);"></td></tr>
                        </table>
                    </div>
                    @*<script>setValueDefault(@item.id,"@Html.Raw(@item.filter_1)","@Html.Raw(@item.filter_2)","@Html.Raw(@item.filter_3)","@Html.Raw(@item.filter_4)","@Html.Raw(@item.filter_5)");</script>*@
                </text>
                totalItemImage++;
            }
        </div> <!-- end row -->
      </div> <!-- end container -->
    </section> <!-- end image-description-container -->

<script>
    
    
    var totalItemImage=@totalItemImage;
    function save(id){
        var formdata = new FormData(); //FormData object
        var filter_1=getValueOfField(id,1);
        var filter_2=getValueOfField(id,2);
        var filter_3=getValueOfField(id,3);
        var filter_4=getValueOfField(id,4);
        var filter_5=getValueOfField(id,5);
       
        if (document.getElementById("keyword_" + id) && document.getElementById("keyword_" + id).value == "") {
                alert("Nhập từ khóa cho ảnh này!");
                document.getElementById("keyword_" + id).focus();
                return;
            }
        //if (document.getElementById("price_" + id) && document.getElementById("price_" + id).value == "") {
        //        alert("Nhập giá cho ảnh này!");
        //        document.getElementById("price_" + id).focus();
        //        return;
        //}
        var sale_type=0;
        //if (document.getElementById("sale_type_" + id+"_2").checked) sale_type=1;;
        //alert(document.getElementById("sale_type_" + id+"_2").checked);
        //return;
        formdata.append("id", id);
        formdata.append("filter_1", filter_1);
        formdata.append("filter_2", filter_2);
        formdata.append("filter_3", filter_3);
        formdata.append("filter_4", filter_4);
        formdata.append("filter_5", filter_5);
        formdata.append("keywords", document.getElementById("keyword_" + id).value );
        formdata.append("price", 1000000);
        formdata.append("sale_type", 0);
        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/Photos/UpdateFilter');
        xhr.send(formdata);
        var content = "";
        xhr.onreadystatechange = function () {
            if (xhr.readyState == 4 && xhr.status == 200) {
                if (xhr.responseText == "1") {
                    alert("Cập nhật thành công");
                    //window.location.href = "/Photos/User/1";
                } else {
                    alert("Chương trình đang cập nhật, xin quay lại sau!");
                }
            }
        }

    }
    function del(id){
        if (!confirm("Bạn có chắc chắn xóa?"))
        {
            return;
        }
        var formdata = new FormData(); //FormData object
        formdata.append("id", id);
        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/Photos/Del');
        xhr.send(formdata);
        var content = "";
        xhr.onreadystatechange = function () {
            if (xhr.readyState == 4 && xhr.status == 200) {
                if (xhr.responseText == "1") {
                    //alert("xóa ảnh thành công");
                    $("#div-"+id).html("");
                    $("#div-"+id).css("background-color","red");
                    $("#div-"+id+"-2").html("");
                    $("#div-"+id+"-2").css("background-color","red");
                } else {
                    alert("Chương trình đang cập nhật, xin quay lại sau!");
                }
            }
        }

    }
    function getValueOfField(id,index){
        var value="";
        for(var i=1;i<=20;i++){
            if(document.getElementById("f-"+id+"-"+index+"_"+i)){
                if (document.getElementById("f-"+id+"-"+index+"_"+i).checked){
                    value+=document.getElementById("f-"+id+"-"+index+"_"+i).value+", ";
                }
            }
        }
        return value;
    }
</script>